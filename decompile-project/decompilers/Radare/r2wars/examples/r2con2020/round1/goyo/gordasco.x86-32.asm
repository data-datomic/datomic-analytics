; Warrior X86 32 bits by goyo.
; Despues del RevientaViejas (r2con2018), viene: 'GORDASCO'
; bot para r2wars (r2con2020)
; Básicamente un replicator con problemas de peso

.bits 	32
Main:
	CALL Boot
Boot:
	POP ESI
	JMP replicator
# Esto para engordar el binario a 512 bytes y reducir el area de busqueda inicial del otro bot a 512.
# Si es rápido podría encontrar al otro antes de que se mueva si es que se mueve.

.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  
.byte 0xff  

replicator:
	CLD
	MOV BX,0x3d7		; memory top
	MOV EDI,ESI
	ADD SI,461		; offset Payload - offset Main  
	MOV EAX,ESI		
	ADD EDI,40		; only for 1st replication
	MOV [EDX],EAX		; Por si alguien se esconde en 0x0 o en 0x3ff y le pillo..
	MOV [EBX+36],EAX
Payload:	
	MOV ESI,EAX     	; payload start
	MOV CL,0x0A		; loop rep // attack // copy to the last .byte 0xcc
	SUB EDI,40+40+3		; separation ( 40 from last movsd + 40 from new movsd + 3 extra)
	JNC Nocheck		; check limits
	MOV EDI,EBX
Nocheck:
	MOV EAX,EDI		
	REP MOVSD		; replicator
	JMP EAX
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc
.byte 0xcc

